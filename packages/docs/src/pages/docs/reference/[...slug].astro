---
import { CollectionEntry, getCollection } from 'astro:content';
import DocsLayout from '../../../layouts/DocsLayout.astro';
import { components } from "../../../components/md/index.astro";
import H2 from '../../../components/md/h2.astro';
import SidebarGroup from '../../../components/sidebar-group.astro';
import HeadingList from '../../../components/heading-list.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('reference');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug !== "index" ? entry.slug : undefined },
    props: { entry, entries: blogEntries.filter(e => e.slug !== "index") },
  }));
}

export interface Props {
  entry: CollectionEntry<"reference">;
  entries: CollectionEntry<"reference">[];
};

const { entry, entries } = Astro.props;
const { Content, headings } = await entry.render();
---

<DocsLayout bodyClassName="overflow-y-scroll" title={entry.data.title}>
  {entries.map(e => (
    <li slot="links" class="py-1"><a href={`/docs/reference/${e.slug}`}>{e.data.title}</a></li>
  ))}

  <div slot="sidebar-left">
    <SidebarGroup title="blinkdb" href="/docs/reference">
      {entries.map(e => (
        <li class="p-0.5"><a href={`/docs/reference/${e.slug}`}>{e.data.title}</a></li>
      ))}
    </SidebarGroup>
  </div>

  <div slot="sidebar-right">
    <HeadingList headings={headings} />
  </div>

  <Content components={components} />
  {entry.slug === "index" && (
    <div>
      <H2>Content</H2>
      <ul class="grid grid-cols-[repeat(auto-fill,minmax(140px,1fr))] w-full justify-center">
        {entries.map(e => (
          <li class="py-1 underline"><a href={`/docs/reference/${e.slug}`}>{e.data.title}</a></li>
        ))}
      </ul>
    </div>
  )}
</DocsLayout>